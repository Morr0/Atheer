@using Atheer.Services.UsersService
@model Atheer.Services.ArticlesService.ArticlesResponse

@{
    ViewData["Title"] = "Articles";
    
    bool authenticated = User.Identity?.IsAuthenticated == true;

    string oldestOrLatestArticlesString = Model.OldestArticles ? "Oldest" : "Latest";
}

@if (User.IsInRole(UserRoles.EditorRole))
{
    @section Button1
    {
        <a class="nav-link text-dark" asp-controller="ArticleEdit" asp-action="AddArticleView">Write Article</a>
    }
}

<h5 class="text-dark">
    @if (!string.IsNullOrEmpty(Model.TagTitle))
    {
        @Html.Raw("Tag: ")
        @Model.TagTitle
        <br/>
    }
    @if (Model.SpecificYear)
    {
        @Model.Year.ToString()
        @Html.Raw(" Articles")
    }
    @if (Model.Search)
    {
        @Html.Raw($"Searched for: {Model.SearchQuery}")
    }
    else
    {
        @Html.Raw($"{oldestOrLatestArticlesString} Articles")
    }
</h5>

@if (string.IsNullOrEmpty(Model.TagId) && !Model.Search)
{
    <h5 class="text-dark">Tags: </h5>
    <ul class="list-group list-group-horizontal flex-fill">
    @foreach (var tag in Model.MostPopularTags)
    {
        <li class="list-group-item">
            <a asp-controller="Articles" asp-action="Index" asp-route-tag="@tag.Id">@tag.Title (@tag.Count.ToString())</a>
        </li>
    }
    </ul>
}
else
{
    <ul class="list-group list-group-horizontal flex-fill">
        <li class="list-group-item">
            <a href="/">All tags</a>
        </li>
    </ul>
}

<div class="mt-3"></div>

@await Component.InvokeAsync("Articles", Model).ConfigureAwait(false)