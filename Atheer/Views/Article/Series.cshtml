@using Atheer.Controllers.Article
@model IList<ArticleSeries>

@{
    ViewData["Title"] = "Series";

    var items = new SelectList(new List<string>()
    {
        "Unfinished",
        "Finished",
        "All"
    });
}

<h3 class="text-dark">Article Series</h3>

<div class="text-danger" asp-validation-summary="All"></div>

<button class="btn btn-outline-primary" id="addButton" type="button">Add</button>
<form asp-controller="Article" asp-action="AddSeries" method="post" hidden id="form">
    <div class="form-group">
        <label for="Title">Title: </label>
        <input type="text" name="Title" class="form-control" required/>
        <label for="Description">Description: </label>
        <textarea class="form-control" name="Description" required></textarea>
        <button type="submit" class="btn btn-primary">Add</button>
        <button type="button" id="closeButton" class="btn btn-secondary">Close</button>
    </div>
</form>

<form method="get" asp-controller="Article" asp-action="SeriesView" id="showSeriesTypeForm">
    <select class="form-select-sm" id="showSeriesTypeSelect" name="SeriesType" asp-items="items">
        <option>@ViewData["SeriesType"]</option>
    </select>
</form>

<ul class="list-group">
    @foreach (var series in Model)
    {
        <li class="list-group-item">
            <span class="text-danger">Id: @series.Id.ToString()</span>
            <h4 class="text-dark">Title: @series.Title</h4>
            <p class="text-body">@series.Description</p>
            @if (series.Finished)
            {
                <span class="text-danger">Finished series</span>
            }
            else
            {
                <form method="post" asp-controller="Article" asp-action="FinishSeries" asp-route-id="@series.Id.ToString()">
                    <button type="submit" class="btn btn-outline-danger">Finish</button>
                </form>
            }
        </li>
    }
</ul>

@section Scripts
{
    <script>
    const addSeriesForm = document.getElementById("form");
    const addSeriesToShowFormButton = document.getElementById("addButton");
    addSeriesToShowFormButton.addEventListener("click", () => {
        addSeriesForm.hidden = false;
    });
    addSeriesForm.addEventListener("submit", () => addSeriesForm.hidden = true);
    const closeButton = document.getElementById("closeButton");
    closeButton.addEventListener("click", () => addSeriesForm.hidden = true);
    
    const showSeriesTypeForm = document.getElementById("showSeriesTypeForm");
    const showSeriesTypeSelect = document.getElementById("showSeriesTypeSelect");
    showSeriesTypeSelect.addEventListener("change", () => showSeriesTypeForm.submit());
    </script>
}
